{% extends 'base.html' %}

{% block content %}

{% if error %}
<div class="alert alert-danger" role="alert">
    <i class="fa-solid fa-triangle-exclamation"></i> {{ error }}
</div>
<div class="alert alert-light">
    <h5>Search another device?</h5>
    <form>
        <input type="text" class="form-control mb-2" style="max-width: 50%;" name="search_serial_number">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
</div>
{% else %}
{% if status == 'success' %}
<div class="alert alert-success" role="alert" id="alert">
    <i class="fa-solid fa-check"></i> Changes saved successfully.
</div>
{% elif status == 'exception' %}
<div class="alert alert-danger" role="alert" id="alert">
    <i class="fa-solid fa-triangle-exclamation"></i> An error occurred while saving changes. Exception: {{ exception|default('-') }}
</div>
{% endif %}
<div class="container-fluid" style="width: 90%; padding-bottom: 48px;">
    <div class="row">
        <div class="col-md-6 mb-3">
            <h1>Device Information</h1>
        </div>
        <div class="col-md-6 mb-3">
            {% if edit %}
            <button type="button" class="btn btn-primary float-end me-2" onclick="window.location.href = `/device/{{ device.serial_number }}`">Disable Edit Mode</button>
            {% else %}
            <button type="button" class="btn btn-outline-primary float-end" onclick="window.location.href = `/device/{{ device.serial_number }}/edit`">Enable Edit Mode</button>
            {% endif %}
        </div>
    </div>
    <form id="deviceForm" method="POST">
        <input type="hidden" name="serial_number_original" value="{{ device.serial_number }}">
        <div class="row">
            <div class="col mb-3">
                <label for="serial_number" class="form-label">Serial Number</label>
                <input type="text" class="form-control" id="serial_number" name="serial_number" value="{{ device.serial_number }}" required {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="purchase_date" class="form-label">Purchase Date</label>
                <input type="date" class="form-control" id="purchase_date" name="purchase_date" value="{{ device.purchase_date }}" required {% if not edit %} readonly {% endif %}>
            </div>
        </div>
        <div class="row">
            <div class="col mb-3">
                <label for="type" class="form-label">Type</label>
                <input type="text" class="form-control" id="type" name="type" value="{{ device.type }}" required {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="brand" class="form-label">Brand</label>
                <input type="text" class="form-control" id="brand" name="brand" value="{{ device.brand }}" required {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="model" class="form-label">Model</label>
                <input type="text" class="form-control" id="model" name="model" value="{{ device.model }}" required {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="operating_system" class="form-label">Operating System</label>
                <input type="text" class="form-control" id="operating_system" name="operating_system" value="{{ device.operating_system }}" required {% if not edit %} readonly {% endif %}>
            </div>
        </div>
        <hr>
        <h3>Hardware Information</h3>
        <h5>Processor</h5>
        <div class="row">
            <div class="col mb-3">
                <label for="cpu" class="form-label">CPU</label>
                <input type="text" class="form-control" id="cpu" name="cpu" value="{{ device.cpu }}" required {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="gpu" class="form-label">GPU</label>
                <input type="text" class="form-control" id="gpu" name="gpu" value="{{ device.gpu }}" {% if not edit %} readonly {% endif %}>
            </div>
        </div>
        <h5>Memory</h5>
        <div class="row">
            <div class="col mb-3">
                <label for="physical_mem_type" class="form-label">Type</label>
                <input type="text" class="form-control" id="physical_mem_type" name="physical_mem_type" value="{{ device.physical_mem_type }}" required {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="physical_mem_size_gb" class="form-label">RAM (GB)</label>
                <input type="number" class="form-control" id="physical_mem_size_gb" name="physical_mem_size_gb" value="{{ device.physical_mem_size_gb }}" required {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="physical_mem_slots" class="form-label">RAM Slots</label>
                <input type="number" class="form-control" id="physical_mem_slots" name="physical_mem_slots" value="{{ device.physical_mem_slots }}" required {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="physical_mem_slots_used" class="form-label">RAM Slots Used</label>
                <input type="number" class="form-control" id="physical_mem_slots_used" name="physical_mem_slots_used" value="{{ device.physical_mem_slots_used }}" required {% if not edit %} readonly {% endif %}>
            </div>
        </div>
        <h5>Storage</h5>
        <div class="row">
            <div class="col mb-3">
                <label for="storage_type" class="form-label">Type</label>
                <input type="text" class="form-control" id="storage_type" name="storage_type" value="{{ device.storage_type }}" required {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="storage_size_gb" class="form-label">Size (GB)</label>
                <input type="number" class="form-control" id="storage_size_gb" name="storage_size_gb" value="{{ device.storage_size_gb }}" required {% if not edit %} readonly {% endif %}>
            </div>
        </div>
        <h5>Display</h5>
        <div class="row">
            <div class="col mb-3">
                <label for="internal_display_type" class="form-label">Type</label>
                <input type="text" class="form-control" id="internal_display_type" name="internal_display_type" value="{{ device.internal_display_type }}" {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="internal_display_size_inch" class="form-label">Size (Inches)</label>
                <input type="text" class="form-control" id="internal_display_size_inch" name="internal_display_size_inch" value="{{ device.internal_display_size_inch }}" {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="internal_display_resolution" class="form-label">Resolution (WxH; Pixels)</label>
                <input type="text" class="form-control" id="internal_display_resolution" name="internal_display_resolution" value="{{ device.internal_display_resolution }}" {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="is_touchscreen" class="form-label">Touchscreen?</label>
                <input type="text" class="form-control" id="is_touchscreen" name="is_touchscreen" value="{{ 'Yes' if device.is_touchscreen else 'No' }}" {% if not edit %} readonly {% endif %}>
            </div>
        </div>
        <hr>
        <h3>Network Information</h3>
        <div class="row">
            <div class="col mb-3">
                <label for="wireless_mac" class="form-label">Wi-Fi MAC Address</label>
                <input type="text" class="form-control" id="wireless_mac" name="wireless_mac" value="{{ device.wireless_mac }}" {% if not edit %} readonly {% endif %}>
            </div>
            <div class="col mb-3">
                <label for="ethernet_mac" class="form-label">Ethernet MAC Address</label>
                <input type="text" class="form-control" id="ethernet_mac" name="ethernet_mac" value="{{ device.ethernet_mac }}" {% if not edit %} readonly {% endif %}>
            </div>
        </div>
        {% if edit %}
        <button type="submit" class="btn btn-primary" formaction="/api/device/edit">Save Changes</button>
        <button type="button" class="btn btn-outline-danger" onclick="show_delete_modal()">Delete Device</button>
        {% endif %}
    </form>
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Delete Device</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this device?</p>
                    <p><mark>This action cannot be undone.</mark></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="delete_device()">Delete</button>
                </div>
            </div>
        </div>  
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    
</script>
{% if error %}
<script>
    document.querySelector('form').addEventListener("submit", function (e)
    {
        e.preventDefault();
        let serial_number = document.querySelector('input[name="search_serial_number"]').value;
        window.location.href = `/device/${serial_number}`;
    })
</script>
{% endif %}
{% if edit %}
<script>
    function show_delete_modal()
    {
        var modal = new bootstrap.Modal(document.getElementById('deleteModal'), { keyboard: false });
        modal.show();
    }

    function delete_device()
    {
        document.querySelector('form').setAttribute('action', '/api/device/delete');
        document.querySelector('form').submit();
    }
</script>
{% endif %}
{% endblock %}